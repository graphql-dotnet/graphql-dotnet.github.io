{"componentChunkName":"component---src-components-docs-page-js","path":"/docs/guides/complexity-analyzer/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"complexity-analyzer\" style=\"position:relative;\"><a href=\"#complexity-analyzer\" aria-label=\"complexity analyzer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Complexity Analyzer</h1>\n<h2 id=\"overview\" style=\"position:relative;\"><a href=\"#overview\" aria-label=\"overview permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Overview</h2>\n<p>The Complexity Analyzer in GraphQL.NET is a powerful tool designed to manage the complexity and depth of GraphQL queries.\nIt ensures that queries remain within acceptable bounds to prevent excessive load on the server. This documentation will\nguide you through the basic and advanced configuration of the complexity analyzer.</p>\n<h3 id=\"key-features\" style=\"position:relative;\"><a href=\"#key-features\" aria-label=\"key features permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Key Features</h3>\n<ul>\n<li>Fields can define the impact for the execution of that field (e.g., how long it will take to execute the ResolveAsync\nmethod) separate from a multiplier applied to the children fields (e.g., how many rows it returns for list fields).</li>\n<li>Default configuration allows for setting three default values:\n<ul>\n<li>Scalar impact (impact to use for scalar fields)</li>\n<li>Object impact (impact to use for object fields)</li>\n<li>Default child multiplier for list fields (multiplier to use for list fields)</li>\n</ul>\n</li>\n<li>Per-field configurable behavior to determine field impact and child impact multipliers; by default it uses the\nscalar impact for scalar fields, object impact for object fields, and the default child multiplier for list fields.</li>\n<li>Default behavior considers connection semantics, such as <code class=\"language-text\">first</code>, <code class=\"language-text\">last</code>, and <code class=\"language-text\">id</code> arguments, to adjust the child\nmultiplier accordingly.</li>\n<li>Configuring a schema to ignore complexity for introspection fields is straightforward.</li>\n<li>Easy to write asynchronous code to implement per-user, per-IP, or throttling limits.</li>\n</ul>\n<h2 id=\"basic-configuration\" style=\"position:relative;\"><a href=\"#basic-configuration\" aria-label=\"basic configuration permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Basic Configuration</h2>\n<h3 id=\"setting-up-complexity-analyzer\" style=\"position:relative;\"><a href=\"#setting-up-complexity-analyzer\" aria-label=\"setting up complexity analyzer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting Up Complexity Analyzer</h3>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">services<span class=\"token punctuation\">.</span><span class=\"token function\">AddGraphQL</span><span class=\"token punctuation\">(</span>b <span class=\"token operator\">=></span> b\n    <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">AddSchema</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>MySchema<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">AddComplexityAnalyzer</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        c<span class=\"token punctuation\">.</span>MaxDepth <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n        c<span class=\"token punctuation\">.</span>MaxComplexity <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"configurable-options\" style=\"position:relative;\"><a href=\"#configurable-options\" aria-label=\"configurable options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configurable Options</h3>\n<table>\n<thead>\n<tr>\n<th>Option</th>\n<th>Description</th>\n<th>Default Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>MaxDepth</td>\n<td>Limits the maximum depth of a query.</td>\n<td>null</td>\n</tr>\n<tr>\n<td>MaxComplexity</td>\n<td>Limits the total complexity of a query.</td>\n<td>null</td>\n</tr>\n<tr>\n<td>DefaultScalarImpact</td>\n<td>Specifies the default complexity impact for scalar fields.</td>\n<td>1</td>\n</tr>\n<tr>\n<td>DefaultObjectImpact</td>\n<td>Specifies the default complexity impact for object fields.</td>\n<td>1</td>\n</tr>\n<tr>\n<td>DefaultListImpactMultiplier</td>\n<td>Specifies the average number of items returned by list fields.</td>\n<td>20</td>\n</tr>\n<tr>\n<td>ValidateComplexityDelegate</td>\n<td>Allows for custom validation and logging based on query complexity and depth.</td>\n<td>null</td>\n</tr>\n<tr>\n<td>DefaultComplexityImpactDelegate</td>\n<td>Provides a default mechanism to calculate field impact and child impact multipliers.</td>\n<td>see below</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"default-complexity-impact-delegate\" style=\"position:relative;\"><a href=\"#default-complexity-impact-delegate\" aria-label=\"default complexity impact delegate permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Default Complexity Impact Delegate</h3>\n<p>The <code class=\"language-text\">DefaultComplexityImpactDelegate</code> is a built-in mechanism in GraphQL.NET that provides a default way to calculate\nthe complexity impact of fields within a query. By default, this delegate assigns a complexity impact based on the type\nof the field being resolved. Scalar fields are given a default impact defined by <code class=\"language-text\">DefaultScalarImpact</code>, while object\nfields are assigned an impact defined by <code class=\"language-text\">DefaultObjectImpact</code>. For list fields, the delegate multiplies the impact\nby the <code class=\"language-text\">DefaultListImpactMultiplier</code>, unless a specific argument like <code class=\"language-text\">first</code>, <code class=\"language-text\">last</code>, or <code class=\"language-text\">id</code> is provided, which\nthen adjusts the multiplier accordingly (set to 1 if the <code class=\"language-text\">id</code> argument is present). The delegate also considers\nconnection semantics, ensuring that the impact is accurately reflected based on parent and child relationships\nwithin the query. This default behavior ensures a logical and consistent calculation of query complexity, making\nit easier to manage and limit query depth and execution cost.</p>\n<h4 id=\"sample-graphql-request-and-computed-complexity\" style=\"position:relative;\"><a href=\"#sample-graphql-request-and-computed-complexity\" aria-label=\"sample graphql request and computed complexity permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sample GraphQL Request and Computed Complexity</h4>\n<p>The below sample assumes that the complexity analyzer is configured with the default values.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>                <span class=\"token comment\">#  impact   multiplier   total impact   child multiplier   depth</span>\n  <span class=\"token property-query\">users</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">first</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>   <span class=\"token comment\">#     1          1             1                 10          1</span>\n    <span class=\"token property\">id</span>                 <span class=\"token comment\">#     1         10            11                             2</span>\n    <span class=\"token object\">posts</span> <span class=\"token punctuation\">{</span>            <span class=\"token comment\">#     1         10            21                 20          2</span>\n      <span class=\"token property\">id</span>               <span class=\"token comment\">#     1        200           221                             3</span>\n      <span class=\"token object\">comments</span> <span class=\"token punctuation\">{</span>       <span class=\"token comment\">#     1        200           421                 20          3</span>\n        <span class=\"token property\">id</span>             <span class=\"token comment\">#     1       4000          4421                             4</span>\n      <span class=\"token punctuation\">}</span>                <span class=\"token comment\">#</span>\n    <span class=\"token punctuation\">}</span>                  <span class=\"token comment\">#</span>\n  <span class=\"token punctuation\">}</span>                    <span class=\"token comment\">#</span>\n  <span class=\"token property-query\">products</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  <span class=\"token comment\">#     1          1          4422                  1          1</span>\n    <span class=\"token property\">id</span>                 <span class=\"token comment\">#     1          1          4423                             2</span>\n    <span class=\"token property\">name</span>               <span class=\"token comment\">#     1          1          4424                             2</span>\n    <span class=\"token object\">photos</span> <span class=\"token punctuation\">{</span>           <span class=\"token comment\">#     1          1          4425                 20          2</span>\n      <span class=\"token property\">id</span>               <span class=\"token comment\">#     1         20          4445                             3</span>\n      <span class=\"token property\">name</span>             <span class=\"token comment\">#     1         20          4465                             3</span>\n    <span class=\"token punctuation\">}</span>                  <span class=\"token comment\">#</span>\n    <span class=\"token object\">category</span> <span class=\"token punctuation\">{</span>         <span class=\"token comment\">#     1          1          4466                  1          2</span>\n      <span class=\"token property\">id</span>               <span class=\"token comment\">#     1          1          4467                             3</span>\n      <span class=\"token property\">name</span>             <span class=\"token comment\">#     1          1          4468                             3</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above query will have the following complexity calculation:</p>\n<ul>\n<li>Maximum Depth: 4 (users -> posts -> comments -> id)</li>\n<li>Total Complexity: 4468</li>\n</ul>\n<p>These values are calculated based on these facts demonstrated in the above query:</p>\n<ul>\n<li>The <code class=\"language-text\">users</code> field requested 10 items, so the child multiplier is set to 10.</li>\n<li>The <code class=\"language-text\">posts</code> field is a list field and uses the default child multiplier of 20.</li>\n<li>The <code class=\"language-text\">comments</code> field is a list field and uses the default child multiplier of 20.</li>\n<li>The <code class=\"language-text\">products</code> field has an <code class=\"language-text\">id</code> argument, so the child multiplier is set to 1.</li>\n<li>The <code class=\"language-text\">photos</code> field is a list field and uses the default child multiplier of 20.</li>\n<li>The <code class=\"language-text\">category</code> field is not a list field and so does not use the default child multiplier.</li>\n<li>Other fields are scalar fields and use the default scalar impact of 1, multiplied by the\nmultiplier calculated for that level of the graph.</li>\n</ul>\n<h2 id=\"example-scenarios\" style=\"position:relative;\"><a href=\"#example-scenarios\" aria-label=\"example scenarios permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example Scenarios</h2>\n<h3 id=\"1-estimating-the-total-number-of-nodes-and-maximum-depth\" style=\"position:relative;\"><a href=\"#1-estimating-the-total-number-of-nodes-and-maximum-depth\" aria-label=\"1 estimating the total number of nodes and maximum depth permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Estimating the Total Number of Nodes and Maximum Depth</h3>\n<p>To configure the complexity analyzer to estimate the total number of nodes returned and/or the maximum depth,\nyou can use the default configuration, or customize the default impact multiplier, or customize the impact\nmultiplier used for specific fields. The default configuration assumes that list fields return an average of 20 items.</p>\n<h4 id=\"configuring-child-impact-multiplier-for-specific-fields\" style=\"position:relative;\"><a href=\"#configuring-child-impact-multiplier-for-specific-fields\" aria-label=\"configuring child impact multiplier for specific fields permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring Child Impact Multiplier for Specific Fields</h4>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// Code-first</span>\nusersField<span class=\"token punctuation\">.</span><span class=\"token function\">WithComplexityImpact</span><span class=\"token punctuation\">(</span>\n    <span class=\"token named-parameter punctuation\">fieldImpact</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token named-parameter punctuation\">childImpactMultiplier</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Assume the users field returns 100 items on average</span>\n\n<span class=\"token comment\">// Schema-first / type-first:</span>\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Complexity</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token named-parameter punctuation\">fieldImpact</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token named-parameter punctuation\">childImpactMultiplier</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">IEnumerable<span class=\"token punctuation\">&lt;</span>User<span class=\"token punctuation\">></span></span> <span class=\"token function\">Users</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">FromServices</span></span><span class=\"token punctuation\">]</span> <span class=\"token class-name\">IUserService</span> userService<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">GetUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"setting-a-global-default-multiplier\" style=\"position:relative;\"><a href=\"#setting-a-global-default-multiplier\" aria-label=\"setting a global default multiplier permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting a Global Default Multiplier</h4>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">complexityConfig<span class=\"token punctuation\">.</span>DefaultListImpactMultiplier <span class=\"token operator\">=</span> <span class=\"token number\">7</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Assume that other list fields return 7 items on average</span></code></pre></div>\n<h4 id=\"sample-graphql-request-and-computed-complexity-1\" style=\"position:relative;\"><a href=\"#sample-graphql-request-and-computed-complexity-1\" aria-label=\"sample graphql request and computed complexity 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sample GraphQL Request and Computed Complexity</h4>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>            <span class=\"token comment\">#  impact   multiplier   total impact   child multiplier   depth</span>\n  <span class=\"token object\">users</span> <span class=\"token punctuation\">{</span>          <span class=\"token comment\">#     1          1             1                100          1</span>\n    <span class=\"token property\">id</span>             <span class=\"token comment\">#     1        100           101                             2</span>\n    <span class=\"token object\">posts</span> <span class=\"token punctuation\">{</span>        <span class=\"token comment\">#     1        100           201                  7          2</span>\n      <span class=\"token property\">id</span>           <span class=\"token comment\">#     1        700           901                             3</span>\n      <span class=\"token object\">comments</span> <span class=\"token punctuation\">{</span>   <span class=\"token comment\">#     1        700          1601                  7          3</span>\n        <span class=\"token property\">id</span>         <span class=\"token comment\">#     1       4900          6501                             4</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above query will have the following complexity calculation:</p>\n<ul>\n<li>Maximum Depth: 4 (users -> posts -> comments -> id)</li>\n<li>Total Complexity: 6501</li>\n</ul>\n<p>Since the number of rows returned from list fields can vary, it is recommended to use connection fields\nand to require the <code class=\"language-text\">first</code> or <code class=\"language-text\">last</code> argument to allow the complexity analzyer to properly estimate the\nchild multiplier for list fields (or have the default page size set very small). You can also choose to\nset the scalar and object impact to zero if you prefer to only consider the number of nodes and maximum\ndepth, similar to the <a href=\"https://docs.github.com/en/graphql/overview/rate-limits-and-node-limits-for-the-graphql-api\">GitHub GraphQL API rate limits</a>.</p>\n<h3 id=\"2-ignoring-or-reducing-impact-of-introspection-requests\" style=\"position:relative;\"><a href=\"#2-ignoring-or-reducing-impact-of-introspection-requests\" aria-label=\"2 ignoring or reducing impact of introspection requests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Ignoring or Reducing Impact of Introspection Requests</h3>\n<p>To prevent introspection requests from affecting the complexity calculation, you can configure the introspection\nfields' impact and child multiplier. An extension method is provided to simplify this configuration as shown below:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// Code-first:</span>\nschema<span class=\"token punctuation\">.</span><span class=\"token function\">WithIntrospectionComplexityImpact</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Ignore introspection fields</span>\n<span class=\"token comment\">// or</span>\nschema<span class=\"token punctuation\">.</span><span class=\"token function\">WithIntrospectionComplexityImpact</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Reduce impact to 10%</span>\n\n<span class=\"token comment\">// During DI setup:</span>\nservices<span class=\"token punctuation\">.</span><span class=\"token function\">AddGraphQL</span><span class=\"token punctuation\">(</span>b <span class=\"token operator\">=></span> b\n    <span class=\"token punctuation\">.</span><span class=\"token function\">ConfigureSchema</span><span class=\"token punctuation\">(</span>schema <span class=\"token operator\">=></span> schema<span class=\"token punctuation\">.</span><span class=\"token function\">WithIntrospectionComplexityImpact</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The above method sets the complexity impact and child multiplier for the three meta-fields to the provided value,\neffectively ignoring or reducing the impact of introspection requests on the complexity calculation.</p>\n<h4 id=\"sample-graphql-request-and-computed-complexity-2\" style=\"position:relative;\"><a href=\"#sample-graphql-request-and-computed-complexity-2\" aria-label=\"sample graphql request and computed complexity 2 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sample GraphQL Request and Computed Complexity</h4>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  <span class=\"token object\">__schema</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">types</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">name</span>\n      <span class=\"token object\">fields</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">name</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above query will have the following complexity calculation:</p>\n<ul>\n<li>Maximum Depth: 4 (schema -> types -> fields -> name)</li>\n<li>Total Complexity: 0</li>\n</ul>\n<p>Please note that the maximum depth calculation will still include introspection fields.</p>\n<p>To ignore introspection fields from the maximum depth calculation, you can write a custom\ncomplexity validation delegate to ignore depth limits for introspection requests:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">complexityConfig<span class=\"token punctuation\">.</span>ValidateComplexityDelegate <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">IsIntrospectionRequest</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>ValidationContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        context<span class=\"token punctuation\">.</span>Error <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ignore complexity errors</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">bool</span></span> <span class=\"token function\">IsIntrospectionRequest</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ValidationContext</span> validationContext<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> validationContext<span class=\"token punctuation\">.</span>Document<span class=\"token punctuation\">.</span>Definitions<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">OfType</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>GraphQLOperationDefinition<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">All</span><span class=\"token punctuation\">(</span>\n            op <span class=\"token operator\">=></span> op<span class=\"token punctuation\">.</span>Operation <span class=\"token operator\">==</span> OperationType<span class=\"token punctuation\">.</span>Query <span class=\"token operator\">&amp;&amp;</span> op<span class=\"token punctuation\">.</span>SelectionSet<span class=\"token punctuation\">.</span>Selections<span class=\"token punctuation\">.</span><span class=\"token function\">All</span><span class=\"token punctuation\">(</span>\n                node <span class=\"token operator\">=></span> node <span class=\"token keyword\">is</span> <span class=\"token class-name\">GraphQLField</span> field <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span>field<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">.</span>Value <span class=\"token operator\">==</span> <span class=\"token string\">\"__schema\"</span> <span class=\"token operator\">||</span> field<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">.</span>Value <span class=\"token operator\">==</span> <span class=\"token string\">\"__type\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"3-estimating-computing-power-database-processing-time\" style=\"position:relative;\"><a href=\"#3-estimating-computing-power-database-processing-time\" aria-label=\"3 estimating computing power database processing time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Estimating Computing Power (Database Processing Time)</h3>\n<p>Another use case for the complexity analyzer is to estimate the computing power required to process a query.\nYou can configure the impact for object fields to estimate the database processing time by setting a custom default\nobject impact or configuring the impact for specific fields. The below examples assume that the scalar impact is 1,\nbut you may wish to adjust this to zero if scalar fields do not require consequential processing time.</p>\n<h4 id=\"configuring-impact-for-object-fields\" style=\"position:relative;\"><a href=\"#configuring-impact-for-object-fields\" aria-label=\"configuring impact for object fields permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configuring Impact for Object Fields</h4>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// Set higher impact for field resolvers that require more processing time</span>\n\n<span class=\"token comment\">// Code-first</span>\nusersField<span class=\"token punctuation\">.</span><span class=\"token function\">WithComplexityImpact</span><span class=\"token punctuation\">(</span><span class=\"token named-parameter punctuation\">fieldImpact</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Schema-first / type-first:</span>\n<span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">Complexity</span><span class=\"token attribute-arguments\"><span class=\"token punctuation\">(</span><span class=\"token named-parameter punctuation\">fieldImpact</span><span class=\"token punctuation\">:</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span></span></span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\">IEnumerable<span class=\"token punctuation\">&lt;</span>User<span class=\"token punctuation\">></span></span> <span class=\"token function\">Users</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token attribute\"><span class=\"token class-name\">FromServices</span></span><span class=\"token punctuation\">]</span> <span class=\"token class-name\">IUserService</span> userService<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> userService<span class=\"token punctuation\">.</span><span class=\"token function\">GetUsers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"setting-a-custom-default-object-impact\" style=\"position:relative;\"><a href=\"#setting-a-custom-default-object-impact\" aria-label=\"setting a custom default object impact permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setting a Custom Default Object Impact</h4>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token comment\">// Set default for object fields (assumed to need to load from a database)</span>\ncomplexityConfig<span class=\"token punctuation\">.</span>DefaultObjectImpact <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h4 id=\"sample-graphql-request-and-computed-complexity-3\" style=\"position:relative;\"><a href=\"#sample-graphql-request-and-computed-complexity-3\" aria-label=\"sample graphql request and computed complexity 3 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sample GraphQL Request and Computed Complexity</h4>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token punctuation\">{</span>            <span class=\"token comment\">#  impact   multiplier   total impact   child multiplier   depth</span>\n  <span class=\"token object\">users</span> <span class=\"token punctuation\">{</span>          <span class=\"token comment\">#    50          1            50                 20          1</span>\n    <span class=\"token property\">id</span>             <span class=\"token comment\">#     1         20            70                             2</span>\n    <span class=\"token object\">posts</span> <span class=\"token punctuation\">{</span>        <span class=\"token comment\">#    20         20           470                 20          2</span>\n      <span class=\"token property\">id</span>           <span class=\"token comment\">#     1        400           870                             3</span>\n      <span class=\"token object\">comments</span> <span class=\"token punctuation\">{</span>   <span class=\"token comment\">#    20        400          8870                 20          3</span>\n        <span class=\"token property\">id</span>         <span class=\"token comment\">#     1       8000         16870                             4</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above query will have the following complexity calculation:</p>\n<ul>\n<li>Maximum Depth: 4 (users -> posts -> comments -> id)</li>\n<li>Total Complexity: 16870</li>\n</ul>\n<h3 id=\"4-logging-complexity-results\" style=\"position:relative;\"><a href=\"#4-logging-complexity-results\" aria-label=\"4 logging complexity results permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Logging Complexity Results</h3>\n<p>In addition to validation, the <code class=\"language-text\">ValidateComplexityDelegate</code> property allows you to log complexity results\nfor monitoring or analysis.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">complexityConfig<span class=\"token punctuation\">.</span>ValidateComplexityDelegate <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// RequestServices may be used to access scoped services within the DI container</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> logger <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>ValidationContext<span class=\"token punctuation\">.</span>RequestServices<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>ILogger<span class=\"token punctuation\">&lt;</span>MySchema<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>Error <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// failed complexity limits</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">LogWarning</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Query Complexity: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">context<span class=\"token punctuation\">.</span>TotalComplexity</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">, Depth: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">context<span class=\"token punctuation\">.</span>MaxDepth</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">else</span>\n        logger<span class=\"token punctuation\">.</span><span class=\"token function\">LogInformation</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Query Complexity: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">context<span class=\"token punctuation\">.</span>TotalComplexity</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">, Depth: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">context<span class=\"token punctuation\">.</span>MaxDepth</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"5-throttling-users-based-on-complexity-analysis\" style=\"position:relative;\"><a href=\"#5-throttling-users-based-on-complexity-analysis\" aria-label=\"5 throttling users based on complexity analysis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Throttling Users Based on Complexity Analysis</h3>\n<p>To throttle users on a per-user basis similar to GitHub's GraphQL API limits, configure the\ncomplexity analyzer with a custom validation delegate. As noted above, <code class=\"language-text\">MaxComplexity</code> and <code class=\"language-text\">MaxDepth</code>,\nif set, are still enforced before this delegate runs.</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\">complexityConfig<span class=\"token punctuation\">.</span>ValidateComplexityDelegate <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Skip throttling if the query has already exceeded complexity limits</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>Error <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> services <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>ValidationContext<span class=\"token punctuation\">.</span>RequestServices<span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get the authenticated user, or use the IP address if unauthenticated</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> user <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span>User<span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> key<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">?.</span>Identity<span class=\"token punctuation\">?.</span>IsAuthenticated <span class=\"token operator\">==</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// For authenticated users, use the user ID</span>\n        key <span class=\"token operator\">=</span> <span class=\"token string\">\"name:\"</span> <span class=\"token operator\">+</span> user<span class=\"token punctuation\">.</span>Identity<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// For unauthenticated users, use the IP address</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> httpContext <span class=\"token operator\">=</span> services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IHttpContextAccessor<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>HttpContext<span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n        key <span class=\"token operator\">=</span> <span class=\"token string\">\"ip:\"</span> <span class=\"token operator\">+</span> httpContext<span class=\"token punctuation\">.</span>Connection<span class=\"token punctuation\">.</span>RemoteIpAddress<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Pull your throttling service (e.g. Polly) from the DI container</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> throttlingService <span class=\"token operator\">=</span> services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IThrottlingService<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Throttle the request based on the complexity, subtracting the complexity from the user's limit</span>\n    <span class=\"token keyword\">var</span> <span class=\"token punctuation\">(</span>allow<span class=\"token punctuation\">,</span> remaining<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> throttlingService<span class=\"token punctuation\">.</span><span class=\"token function\">ThrottleAsync</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">.</span>TotalComplexity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Get the current HttpContext</span>\n    <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> httpContext <span class=\"token operator\">=</span> services<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetRequiredService</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IHttpContextAccessor<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>HttpContext<span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Add a header indicating the remaining throttling limit</span>\n    httpContext<span class=\"token punctuation\">.</span>Response<span class=\"token punctuation\">.</span>Headers<span class=\"token punctuation\">[</span><span class=\"token string\">\"X-RateLimit-Remaining\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> remaining<span class=\"token punctuation\">.</span><span class=\"token function\">ToString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Report an error if the user has exceeded their limit</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>allow<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        context<span class=\"token punctuation\">.</span>Error <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token constructor-invocation class-name\">ValidationError</span><span class=\"token punctuation\">(</span><span class=\"token interpolation-string\"><span class=\"token string\">$\"Query complexity of </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">context<span class=\"token punctuation\">.</span>TotalComplexity</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> exceeded throttling limit. Remaining: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span><span class=\"token expression language-csharp\">remaining</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"6-throttling-users-based-on-execution-time\" style=\"position:relative;\"><a href=\"#6-throttling-users-based-on-execution-time\" aria-label=\"6 throttling users based on execution time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. Throttling Users Based on Execution Time</h3>\n<p>While the complexity analyzer does not directly measure execution time, you can use\n<code class=\"language-text\">ExecutionOptions.Timeout</code> / <code class=\"language-text\">WithTimeout</code> to control the maximum execution time of a query.\nSee the following documentation for more information:</p>\n<p><a href=\"https://graphql-dotnet.github.io/docs/migrations/migration8/#24-execution-timeout-support\">https://graphql-dotnet.github.io/docs/migrations/migration8/#24-execution-timeout-support</a></p>\n<h2 id=\"advanced-configurations\" style=\"position:relative;\"><a href=\"#advanced-configurations\" aria-label=\"advanced configurations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advanced configurations</h2>\n<h3 id=\"defining-custom-complexity-calculations\" style=\"position:relative;\"><a href=\"#defining-custom-complexity-calculations\" aria-label=\"defining custom complexity calculations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Defining Custom Complexity Calculations</h3>\n<p>To set custom complexity calculations for specific fields, you can use the <code class=\"language-text\">WithComplexityImpact</code> overload\nthat defines a calculation delegate as demonstrated in the following example:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token generic-method\"><span class=\"token function\">Field</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>ListGraphType<span class=\"token punctuation\">&lt;</span>ProductGraphType<span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"products\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Argument</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IntGraphType<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"offset\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">Argument</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span>IntGraphType<span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"limit\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">WithComplexityImpact</span><span class=\"token punctuation\">(</span>context <span class=\"token operator\">=></span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> fieldImpact <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\"><span class=\"token keyword\">var</span></span> childImpactModifier <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token generic-method\"><span class=\"token function\">GetArgument</span><span class=\"token generic class-name\"><span class=\"token punctuation\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">\"limit\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// use 20 if unspecified</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span><span class=\"token punctuation\">(</span>fieldImpact<span class=\"token punctuation\">,</span> childImpactModifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","fields":{"relativePath":"docs/guides/complexity-analyzer.md"}},"site":{"siteMetadata":{"githubEditUrl":"https://github.com/graphql-dotnet/graphql-dotnet/edit/master/docs2/site"}}},"pageContext":{"relativePath":"docs/guides/complexity-analyzer.md"}},"staticQueryHashes":["3402777086"],"slicesMap":{}}