<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.15.0"/><meta data-react-helmet="true" name="description" content="GraphQL for .NET"/><meta data-react-helmet="true" name="keywords" content="graphql,api,web api,.net,.net core"/><style data-href="/styles.a7f72cad4b0a7de4791e.css" data-identity="gatsby-global-css">.landing{margin:1.8rem auto}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:sans-serif}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{word-wrap:break-word;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:georgia,serif;-webkit-font-kerning:normal;font-kerning:normal;font-weight:400}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem}ol{padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}html{color:#2c3e50}body,html{-webkit-font-smoothing:antialiased;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-size:16px;overflow:auto;text-rendering:optimizeLegibility}body{margin:0}#___gatsby{overflow:auto}#gatsby-focus-wrapper{height:100%}ul{padding:0}li,ul{margin:0}a{color:#3eaf7c;text-decoration:underline}.header{border-bottom:1px solid #eaecef;height:60px}.header ul{padding:20px}.header li{display:inline-block;list-style:none;padding:0 12px}.header li a{color:#2c3e50;text-decoration:none}.footer{height:60px}.footer,.header{flex:none}.page-body{display:flex;flex-direction:column;height:calc(100% - 60px)}.content{height:100%;overflow-x:hidden;overflow-y:hidden;padding:2em;width:100%}.content ul{margin:20px 0}.content ul li{margin:0 0 0 30px}.content blockquote{border-left:7px solid #eaecef;margin:0 0 1.45rem;padding:30px}.content pre{margin-bottom:1.45rem}.content-body,.content-toolbar{margin:0 auto;max-width:740px}.content-toolbar{padding:1rem 0}.nav{border:0;flex-grow:1;min-width:18rem;order:1;overflow-x:hidden;overflow-y:inherit;padding-top:2rem}.nav li{list-style:none}.nav li span{display:block;font-weight:600;padding:.25rem 1rem .25rem 1.5rem}.nav ul{margin-bottom:15px}.nav ul a{border-left:.25rem solid transparent;color:#2c3e50;display:inline-block;line-height:1.4;padding:.25rem 1rem .25rem 1.25rem;text-decoration:none}.nav ul a:hover{color:#3eaf7c}.nav ul a.active{border-left:.25rem solid #3eaf7c;color:#3eaf7c;text-decoration:none}@media (min-width:768px){#___gatsby,body,html{height:100%;overflow-y:hidden}.page-body{flex-direction:row}.content{overflow-y:auto}.ads,.nav{order:-1}.nav{border-right:1px solid #eaecef;overflow-y:auto}}</style><title data-react-helmet="true">GraphQL .NET</title><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><nav class="header"><ul><li><a href="/">GraphQL.NET</a></li><li><a href="/docs/getting-started/introduction/">Docs</a></li><li><a href="https://github.com/graphql-dotnet/graphql-dotnet" rel="noopener noreferrer" target="_blank">GitHub</a></li></ul></nav><div class="page-body"><div class="content"><article class="content-body"><h1 id="dependency-injection" style="position:relative;"><a href="#dependency-injection" aria-label="dependency injection permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency Injection</h1>
<p>GraphQL.NET supports dependency injection through a <code class="language-text">IServiceProvider</code> interface that is passed to the Schema class. Internally when trying to resolve a type the library will call the methods on this interface.</p>
<blockquote>
<p>The library resolves a <code class="language-text">GraphType</code> only once and caches that type for the lifetime of the <code class="language-text">Schema</code>.</p>
</blockquote>
<p>The default implementation of <code class="language-text">IServiceProvider</code> uses <code class="language-text">Activator.CreateInstance</code>. <code class="language-text">Activator.CreateInstance</code> requires that an object have a public parameterless constructor.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">DefaultServiceProvider</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IServiceProvider</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">GetService</span><span class="token punctuation">(</span><span class="token class-name">Type</span> serviceType<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>serviceType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>serviceType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> Activator<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span>serviceType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Exception</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Failed to call Activator.CreateInstance. Type: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">serviceType<span class="token punctuation">.</span>FullName</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You can override the default implementation by passing a <code class="language-text">IServiceProvider</code> to the constructor of your <code class="language-text">Schema</code>.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StarWarsSchema</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">GraphQL<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>Schema</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">StarWarsSchema</span><span class="token punctuation">(</span><span class="token class-name">IServiceProvider</span> provider<span class="token punctuation">,</span> <span class="token class-name">StarWarsQuery</span> query<span class="token punctuation">,</span> <span class="token class-name">StarWarsMutation</span> mutation<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Query <span class="token operator">=</span> query<span class="token punctuation">;</span>
        Mutation <span class="token operator">=</span> mutation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>How you integrate this into your system will depend on the dependency injection framework you are using. <code class="language-text">FuncServiceProvider</code> is provided for easy integration with multiple containers.</p>
<h2 id="dependency-injection-registration-helpers" style="position:relative;"><a href="#dependency-injection-registration-helpers" aria-label="dependency injection registration helpers permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency Injection Registration Helpers</h2>
<p>GraphQL.NET provides an <code class="language-text">IGraphQLBuilder</code> interface which encapsulates the configuration methods of a dependency injection framework, to provide an
abstract method of configuring a dependency injection framework to work with GraphQL.NET. This interface is provided through a configuration delegate
from a DI-provider-specific setup method (typically called <code class="language-text">AddGraphQL()</code>), at which point you can call extension methods on the interface to
configure this library. A simple example is below:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">services<span class="token punctuation">.</span><span class="token function">AddGraphQL</span><span class="token punctuation">(</span>builder <span class="token operator">=></span> builder
    <span class="token punctuation">.</span><span class="token function">AddSystemTextJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSchema</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MySchema<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The interface also allows configuration of the schema during initialization, and configuration of the execution at runtime. In this manner, adding
middleware, for example, is as simple as calling <code class="language-text">.AddMiddleware&lt;MyMiddlware>()</code> and does not require the middleware to be added into the schema
configuration.</p>
<p>The <code class="language-text">AddGraphQL()</code> method will register default implementations of the following services within the dependency injection framework:</p>
<ul>
<li><code class="language-text">IDocumentExecuter</code> and <code class="language-text">IDocumentExecuter&lt;></code></li>
<li><code class="language-text">IDocumentBuilder</code></li>
<li><code class="language-text">IDocumentValidator</code></li>
<li><code class="language-text">IErrorInfoProvider</code></li>
<li><code class="language-text">IExecutionStrategySelector</code></li>
</ul>
<p>These generic graph types are also registered:</p>
<ul>
<li><code class="language-text">EdgeType&lt;></code>, <code class="language-text">ConnectionType&lt;></code>, <code class="language-text">ConnectionType&lt;,></code> and <code class="language-text">PageInfoType</code></li>
<li><code class="language-text">EnumerationGraphType&lt;></code></li>
<li><code class="language-text">InputObjectGraphType&lt;></code></li>
<li><code class="language-text">AutoRegisteringInputObjectGraphType&lt;></code></li>
<li><code class="language-text">AutoRegisteringObjectGraphType&lt;></code></li>
<li><code class="language-text">AutoRegisteringInterfaceGraphType&lt;></code></li>
</ul>
<p>A list of the available extension methods is below:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description / Notes</th>
<th>Library</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-text">AddAutoClrMappings</code></td>
<td>Configures unmapped CLR types to use auto-registering graph types</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddAutoSchema</code></td>
<td>Registers a schema based on CLR types</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddClrTypeMappings</code></td>
<td>Scans the specified assembly for graph types intended to represent CLR types and registers them within the schema</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddComplexityAnalyzer</code></td>
<td>Enables the complexity analyzer and configures its options</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddDataLoader</code></td>
<td>Registers classes necessary for data loader support</td>
<td>GraphQL.DataLoader</td>
</tr>
<tr>
<td><code class="language-text">AddDocumentCache&lt;></code></td>
<td>Registers the specified document caching service</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddDocumentExecuter&lt;></code></td>
<td>Registers the specified document executer; useful when needed to change the execution strategy utilized</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddDocumentListener&lt;></code></td>
<td>Registers the specified document listener and configures execution to use it</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddErrorInfoProvider</code></td>
<td>Registers a custom error info provider or configures the default error info provider</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddExecutionStrategy</code></td>
<td>Registers an <code class="language-text">ExecutionStrategyRegistration</code> for the selected execution strategy and operation type</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddExecutionStrategySelector</code></td>
<td>Registers the specified execution strategy selector</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddFederation</code></td>
<td>Registers the federation types and configures the schema to support Apollo Federation</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddGraphTypes</code></td>
<td>Scans the specified assembly for graph types and registers them within the DI framework</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddGraphTypeMappingProvider</code></td>
<td>Registers a graph type mapping provider for unmapped CLR types</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddLegacyComplexityAnalyzer</code></td>
<td>Enables the v7 complexity analyzer and configures its options</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddNewtonsoftJson</code></td>
<td>Registers the serializer that uses Newtonsoft.Json as its underlying JSON serialization engine</td>
<td>GraphQL.NewtonsoftJson</td>
</tr>
<tr>
<td><code class="language-text">AddResolveFieldContextAccessor</code></td>
<td>Registers <code class="language-text">IResolveFieldContextAccessor</code> to access the current field context from services</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddSchema&lt;></code></td>
<td>Registers the specified schema</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddSchemaVisitor&lt;></code></td>
<td>Registers the specified schema visitor and configures it to be used at schema initialization</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddSelfActivatingSchema&lt;></code></td>
<td>Registers the specified schema which will create instances of unregistered graph types during initialization</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddSerializer&lt;></code></td>
<td>Registers the specified serializer</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddSystemTextJson</code></td>
<td>Registers the serializer that uses System.Text.Json as its underlying JSON serialization engine</td>
<td>GraphQL.SystemTextJson</td>
</tr>
<tr>
<td><code class="language-text">AddUnhandledExceptionHandler</code></td>
<td>Configures the unhandled exception handler</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">AddValidationRule&lt;></code></td>
<td>Registers the specified validation rule and configures it to be used at runtime</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">ConfigureExecution</code></td>
<td>Configures execution middleware to monitor or modify both options and the result</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">ConfigureExecutionOptions</code></td>
<td>Configures execution options at runtime</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">ConfigureSchema</code></td>
<td>Configures schema options when the schema is initialized</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">Configure&lt;TOptions></code></td>
<td>Used by extension methods to configures an options class within the DI framework</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">UseApolloTracing</code></td>
<td>Registers and enables metrics depending on the supplied arguments, and adds Apollo Tracing data to the execution result</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">UseAutomaticPersistedQueries</code></td>
<td>Enables Automatic Persisted Queries support</td>
<td>GraphQL.MemoryCache</td>
</tr>
<tr>
<td><code class="language-text">UseMemoryCache</code></td>
<td>Registers the memory document cache and configures its options</td>
<td>GraphQL.MemoryCache</td>
</tr>
<tr>
<td><code class="language-text">UseMiddleware&lt;></code></td>
<td>Registers the specified middleware and configures it to be installed during schema initialization</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">UsePersistedDocuments</code></td>
<td>Registers the persisted document handler and configures its options</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">UseTelemetry</code></td>
<td>Creates telemetry events based on the System.Diagnostics.Activity API, primarily for use with OpenTelemetry</td>
<td>.NET 5+</td>
</tr>
<tr>
<td><code class="language-text">ValidateServices</code></td>
<td>Verifies that all injected services can be created during GraphQL field execution</td>
<td></td>
</tr>
<tr>
<td><code class="language-text">WithTimeout</code></td>
<td>Configures the execution timeout</td>
<td></td>
</tr>
</tbody>
</table>
<p>The above methods will register the specified services typically as singletons unless otherwise specified. Graph types and middleware are registered
as transients so that they will match the schema lifetime. So with a singleton schema, all services are effectively singletons.</p>
<p>Calls to <code class="language-text">ConfigureExecutionOptions</code> and methods that start with <code class="language-text">Add</code> will execute first, in the order they
appear, followed by calls to <code class="language-text">ConfigureExecution</code> and methods that start with <code class="language-text">Use</code>. The order of the calls
may be important. For instance, calling <code class="language-text">UseMemoryCache</code> prior to <code class="language-text">UseAutomaticPersistedQueries</code> would result in
the memory cache being unable to cache any APQ queries.</p>
<p>Custom <code class="language-text">IGraphQLBuilder</code> extension methods typically rely on the <code class="language-text">Services</code> property of the builder in order to register services
with the underlying dependency injection framework. The <code class="language-text">Services</code> property returns a <code class="language-text">IServiceRegister</code> interface which has these methods:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-text">Register</code></td>
<td>Registers a service within the DI framework replacing existing registration if needed</td>
</tr>
<tr>
<td><code class="language-text">TryRegister</code></td>
<td>Registers a service within the DI framework if it has not already been registered</td>
</tr>
</tbody>
</table>
<p>To use the <code class="language-text">AddGraphQL</code> method, you will need to install the proper nuget package for your DI provider. See list below:</p>
<table>
<thead>
<tr>
<th>DI Provider</th>
<th>Nuget Package</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft.Extensions.DependencyInjection</td>
<td>GraphQL.MicrosoftDI</td>
</tr>
</tbody>
</table>
<h2 id="aspnet-core" style="position:relative;"><a href="#aspnet-core" aria-label="aspnet core permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ASP.NET Core</h2>
<p><a href="https://github.com/graphql-dotnet/examples/blob/8d5b7544006902f45b818010585b1ffa86ef446b/src/AspNetCoreCustom/Example/Startup.cs#L16-L34">See this example.</a></p>
<p><code class="language-text">Microsoft.Extensions.DependencyInjection</code> package used in ASP.NET Core already has support for resolving <code class="language-text">IServiceProvider</code> interface so no additional settings are required - just add your required dependencies:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDocumentExecuter<span class="token punctuation">,</span> DocumentExecuter<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IGraphQLSerializer<span class="token punctuation">,</span> GraphQLSerializer<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StarWarsData<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StarWarsQuery<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StarWarsMutation<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HumanType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>HumanInputType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DroidType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CharacterInterface<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EpisodeEnum<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISchema<span class="token punctuation">,</span> StarWarsSchema<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To avoid having to register all of the individual graph types in your project, you can
import the <a href="https://www.nuget.org/packages/GraphQL.MicrosoftDI">GraphQL.MicrosoftDI NuGet package</a>
package and utilize the <code class="language-text">SelfActivatingServiceProvider</code> wrapper as follows:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ISchema<span class="token punctuation">,</span> StarWarsSchema<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>services <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StarWarsSchema</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">SelfActivatingServiceProvider</span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you previously pulled in your query, mutation and/or subscription classes via dependency injection, you will need
to manually pull in those dependencies from the <code class="language-text">SelfActivatingServiceProvider</code> via <code class="language-text">GetRequiredService</code> as follows:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StarWarsSchema</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Schema</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">StarWarsSchema</span><span class="token punctuation">(</span><span class="token class-name">IServiceProvider</span> serviceProvider<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>serviceProvider<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Query <span class="token operator">=</span> serviceProvider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StarWarsQuery<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Mutation <span class="token operator">=</span> serviceProvider<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StarWarsMutation<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>No other graph types will need to be registered. Graph types will only be instantiated once, during schema initialization
as usual. Graph types can also pull in any services registered with dependency injection as usual.</p>
<p>Note that if any of the graph types directly or indirectly implement <code class="language-text">IDisposable</code>, be sure to register those types with your dependency
injection provider, or their <code class="language-text">Dispose</code> methods will not be called. Any dependencies of graph types that implement
<code class="language-text">IDisposable</code> will be disposed of properly, regardless of whether the graph type is registered within the service provider.</p>
<p>You can also use the <code class="language-text">.AddGraphTypes()</code> builder method to scan the calling or specified assembly for classes that implement
<code class="language-text">IGraphType</code> and register them all as transients within the service provider. Mark your class with <code class="language-text">DoNotRegisterAttribute</code> if you
want to skip registration.</p>
<h2 id="nancy-tinyioccontainer" style="position:relative;"><a href="#nancy-tinyioccontainer" aria-label="nancy tinyioccontainer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Nancy TinyIoCContainer</h2>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureApplicationContainer</span><span class="token punctuation">(</span><span class="token class-name">TinyIoCContainer</span> container<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">ConfigureApplicationContainer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

    container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> overloads<span class="token punctuation">)</span> <span class="token operator">=></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StarWarsSchema</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FuncServiceProvider</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Resolve<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="simplecontainer" style="position:relative;"><a href="#simplecontainer" aria-label="simplecontainer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SimpleContainer</h2>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SimpleContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container<span class="token punctuation">.</span><span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">StarWarsSchema</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FuncServiceProvider</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>Get<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="autofac" style="position:relative;"><a href="#autofac" aria-label="autofac permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Autofac</h2>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Load</span><span class="token punctuation">(</span><span class="token class-name">ContainerBuilder</span> builder<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    builder
      <span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>c <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FuncServiceProvider</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IComponentContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Resolve<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IServiceProvider<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">InstancePerDependency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="castle-windsor" style="position:relative;"><a href="#castle-windsor" aria-label="castle windsor permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Castle Windsor</h2>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Install</span><span class="token punctuation">(</span><span class="token class-name">IWindsorContainer</span> container<span class="token punctuation">,</span> <span class="token class-name">IConfigurationStore</span> store<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    container<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>
      Component
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IServiceProvider<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">UsingFactoryMethod</span><span class="token punctuation">(</span>k <span class="token operator">=></span> k<span class="token punctuation">.</span>Resolve<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="schema-service-lifetime" style="position:relative;"><a href="#schema-service-lifetime" aria-label="schema service lifetime permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Schema Service Lifetime</h1>
<p>Most dependency injection frameworks allow for specifying different service lifetimes for different
services. Although they may have different names with different frameworks, the three most common
lifetimes are as follows:</p>
<ul>
<li><strong>Transient</strong> services are created every time they are injected or requested.</li>
<li><strong>Scoped</strong> services are created per scope. In a web application, every web request creates a new unique service scope. That means scoped services are generally created per web request.</li>
<li><strong>Singleton</strong> services are created per DI container. That generally means that they are created only one time per application and then used for whole the application life time.</li>
</ul>
<blockquote>
<p>It is <em>highly</em> recommended that the schema is registered as a singleton. As all graph types are constructed at the</p>
</blockquote>
<p>same time as the schema, all graph types will effectively have a singleton lifetime, regardless
of how it is registered with the DI framework. This is most performant approach. Having a scoped schema can degrade performance
by a huge margin. For instance, even a small schema execution can slow down by 100x, and much more with a large schema.</p>
<p>Scoped lifetime can be used to allow the schema and all its graph types access to the current DI scope.
This is not recommended; please see <a href="#scoped-services-with-a-singleton-schema-lifetime">Scoped Services</a>
below. With scoped schemas, it is <strong>required</strong> that all its graph types are registered within the DI
framework as scoped or transient services.</p>
<p>Transient lifetime is also not recommended due to performance degradation. For schemas having a transient
lifetime, it is <strong>required</strong> that all its graph types are also registered within the DI framework as
transient services.</p>
<h1 id="scoped-services-with-a-singleton-schema-lifetime" style="position:relative;"><a href="#scoped-services-with-a-singleton-schema-lifetime" aria-label="scoped services with a singleton schema lifetime permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scoped services with a singleton schema lifetime</h1>
<p>For reasons described above, it is recommended that the schema is registered as a singleton within
the dependency injection framework. However, this prevents including scoped services within the
constructor of the schema or your custom graph types.</p>
<p>To use scoped services (e.g. HttpContext scoped services in ASP.NET Core) you will need to pass
the scoped service provider into the <code class="language-text">ExecutionOptions.RequestServices</code> property. Then within
any field resolver or field middleware, you can access the <code class="language-text">IResolveFieldContext.RequestServices</code>
property to resolve types via the scoped service provider. Typical integration with ASP.NET Core
might look like this:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> _executer<span class="token punctuation">.</span><span class="token function">ExecuteAsync</span><span class="token punctuation">(</span>options <span class="token operator">=></span>
<span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>Schema <span class="token operator">=</span> _schema<span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>Query <span class="token operator">=</span> request<span class="token punctuation">.</span>Query<span class="token punctuation">;</span>
    options<span class="token punctuation">.</span>Variables <span class="token operator">=</span> _serializer<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Deserialize</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Inputs<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Variables<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// IGraphQLTextSerializer from DI</span>
    options<span class="token punctuation">.</span>RequestServices <span class="token operator">=</span> context<span class="token punctuation">.</span>RequestServices<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You could then call scoped services from within field resolvers as shown in the following example:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StarWarsQuery</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObjectGraphType</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">StarWarsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token generic-method"><span class="token function">Field</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DroidType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token string">"hero"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>context <span class="token operator">=></span> context<span class="token punctuation">.</span>RequestServices<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDroidRepo<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetDroid</span><span class="token punctuation">(</span><span class="token string">"R2-D2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="thread-safety-with-scoped-services" style="position:relative;"><a href="#thread-safety-with-scoped-services" aria-label="thread safety with scoped services permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Thread safety with scoped services</h1>
<p>When using scoped services, be aware that most scoped services are not thread-safe. Therefore you will likely
need to use the <code class="language-text">SerialExecutionStrategy</code> execution strategy, or write code to create a service scope
for the duration of the execution of the field resolver that requires a scoped service. For instance, with
Entity Framework Core, typically the database context is registered as a scoped service and obtained via
dependency injection. To continue to use the database context in the same manner with a singleton schema,
you would need to use a serial execution strategy, or create a scope within each field resolver that
requires database access, as shown in the following example:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StarWarsQuery</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObjectGraphType</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">StarWarsQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token generic-method"><span class="token function">Field</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DroidType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token string">"hero"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>context <span class="token operator">=></span>
            <span class="token punctuation">{</span>
                <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> scope <span class="token operator">=</span> context<span class="token punctuation">.</span>RequestServices<span class="token punctuation">.</span><span class="token function">CreateScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> services <span class="token operator">=</span> scope<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">;</span>
                <span class="token keyword">return</span> services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyDbContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Droids<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>There are classes to assist with this within the <a href="https://www.nuget.org/packages/GraphQL.MicrosoftDI">GraphQL.MicrosoftDI NuGet package</a>.
Sample usage is as follows:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGraphType</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObjectGraphType<span class="token punctuation">&lt;</span>Category<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyGraphType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Field</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>context <span class="token operator">=></span> context<span class="token punctuation">.</span>Source<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token generic-method"><span class="token function">Field</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ListGraphType<span class="token punctuation">&lt;</span>ProductGraphType<span class="token punctuation">></span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token string">"Products"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ResolveScopedAsync</span><span class="token punctuation">(</span>context <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> context<span class="token punctuation">.</span>RequestServices<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyDbContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>CategoryId <span class="token operator">==</span> context<span class="token punctuation">.</span>Source<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In this case <code class="language-text">context.RequestServices</code> will be an <code class="language-text">IServiceProvider</code> in a newly created scope.</p>
<p>Be aware that using the service locator in this fashion described in this section could be considered an
Anti-Pattern. See <a href="https://blog.ploeh.dk/2010/02/03/ServiceLocatorisanAnti-Pattern/">Service Locator is an Anti-Pattern</a>.
However, the performance benefits far outweigh the anti-pattern idealogy, when compared to creating a scoped schema.</p>
<p>Within the <code class="language-text">GraphQL.MicrosoftDI</code> package, there is also a builder approach to adding scoped dependencies.
This makes for a concise and declarative approach. Each field clearly states the services it needs
and thereby, the anti-pattern argument does not apply anymore.</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyGraphType</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObjectGraphType<span class="token punctuation">&lt;</span>Category<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyGraphType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">Field</span><span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>context <span class="token operator">=></span> context<span class="token punctuation">.</span>Source<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token generic-method"><span class="token function">Field</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ListGraphType<span class="token punctuation">&lt;</span>ProductGraphType<span class="token punctuation">></span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token string">"Products"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">WithScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// creates a service scope as described above; not necessary for serial execution</span>
            <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">WithService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MyDbContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ResolveAsync</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> db<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span>CategoryId <span class="token operator">==</span> context<span class="token punctuation">.</span>Source<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Another approach to resolve scoped services is to use the SteroidsDI project, as described below.</p>
<h2 id="using-steroidsdi" style="position:relative;"><a href="#using-steroidsdi" aria-label="using steroidsdi permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using SteroidsDI</h2>
<p>To use <a href="https://github.com/sungam3r/SteroidsDI">SteroidsDI</a> with ASP.NET Core, add <code class="language-text">Defer&lt;></code> and <code class="language-text">IScopeProvider</code> in your <code class="language-text">Startup.ConfigureServices</code>:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>

    <span class="token comment">// Add SteroidsDI Open Generic Defer&lt;> Factory Class</span>
    services<span class="token punctuation">.</span><span class="token function">AddDefer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Add SteroidsDI IScopeProvider to use the AspNetCoreHttpScopeProvider</span>
    <span class="token comment">// which internally uses the IHttpContextAccessor.HttpContext.RequestServices;</span>
    services<span class="token punctuation">.</span><span class="token function">AddHttpScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token range operator">..</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then in your query graph types you can request services using <code class="language-text">Defer&lt;T></code> to be injected via DI,
which will be evaluated at runtime to their relevant Scoped services, <code class="language-text">T</code> has been registered with a <code class="language-text">Scoped</code> DI lifetime:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StarWarsQuery</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ObjectGraphType</span></span>
<span class="token punctuation">{</span>
  <span class="token comment">// #1 - Add dependencies using Defer&lt;T></span>
  <span class="token keyword">public</span> <span class="token function">StarWarsQuery</span><span class="token punctuation">(</span><span class="token class-name">Defer<span class="token punctuation">&lt;</span>IDroidRepo<span class="token punctuation">></span></span> repoFactory<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token generic-method"><span class="token function">Field</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DroidType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token string">"hero"</span><span class="token punctuation">)</span>
        <span class="token comment">// #2 Resolve dependencies using current scope provider</span>
        <span class="token punctuation">.</span><span class="token function">Resolve</span><span class="token punctuation">(</span>context <span class="token operator">=></span> repoFactory<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">GetDroid</span><span class="token punctuation">(</span><span class="token string">"R2-D2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<ol>
<li>Add <code class="language-text">Defer&lt;T></code> to be injected by the dependency injection container. This is a factory which upon calling <code class="language-text">Defer.Value</code> will resolve the requested service using any currently registered scope provider (e.g. <code class="language-text">AspNetCoreHttpScopeProvider</code>)</li>
<li>Use the <code class="language-text">Defer&lt;T></code> factory class to resolve the requested dependency using any currently registered scope provider. In our case it will attempt to use the <code class="language-text">IHttpContextAccessor.HttpContext.RequestServices</code> which is the ASP.NET Core Scoped <code class="language-text">IServiceProvider</code> in order to resolve the dependency.</li>
</ol>
<h2 id="scoped-services-in-graphql-subscriptions" style="position:relative;"><a href="#scoped-services-in-graphql-subscriptions" aria-label="scoped services in graphql subscriptions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scoped Services in GraphQL Subscriptions</h2>
<p>Dependency injection scopes behave differently in GraphQL.NET <strong>subscriptions</strong> than in queries and mutations, which can cause scoped services to fail to resolve by default; this section shows how to configure GraphQL.NET to support scoped services in subscription resolvers.</p>
<h3 id="overview" style="position:relative;"><a href="#overview" aria-label="overview permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h3>
<p>GraphQL.NET integrates with ASP.NET Core dependency injection.
For <strong>queries</strong> and <strong>mutations</strong>, each execution runs within a valid request scope, allowing scoped services (such as <code class="language-text">DbContext</code>) to be resolved safely.</p>
<p><strong>Subscriptions</strong>, however, are executed differently and require special configuration when scoped services are involved.</p>
<h2 id="subscription-execution-lifecycle" style="position:relative;"><a href="#subscription-execution-lifecycle" aria-label="subscription execution lifecycle permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscription Execution Lifecycle</h2>
<p>A GraphQL subscription has two distinct execution phases:</p>
<ol>
<li>
<p><strong>Subscription setup</strong></p>
<ul>
<li>Triggered when the client sends the subscription request</li>
<li>Runs within the original HTTP request scope</li>
</ul>
</li>
<li>
<p><strong>Event execution</strong></p>
<ul>
<li>Triggered each time a subscription event is published</li>
<li>Executes outside the original HTTP request lifecycle</li>
</ul>
</li>
</ol>
<p>Because event execution may occur long after the initial request has completed, the original dependency injection scope may already be disposed.</p>
<h2 id="why-code-classlanguage-textrequestservicescode-may-be-disposed" style="position:relative;"><a href="#why-code-classlanguage-textrequestservicescode-may-be-disposed" aria-label="why code classlanguage textrequestservicescode may be disposed permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Why <code class="language-text">RequestServices</code> May Be Disposed</h2>
<p>By default, GraphQL.NET does <strong>not</strong> create a new dependency injection scope for each subscription event.</p>
<p>As a result:</p>
<ul>
<li><code class="language-text">IServiceProvider</code> stored in <code class="language-text">context.RequestServices</code> may be disposed</li>
<li>Attempting to resolve scoped services can throw:</li>
</ul>
<p>This behavior commonly occurs when subscription resolvers depend on scoped services such as repositories or database contexts.</p>
<h2 id="related-issue" style="position:relative;"><a href="#related-issue" aria-label="related issue permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Related Issue</h2>
<p>This behavior was reported and discussed in:</p>
<ul>
<li><a href="https://github.com/graphql-dotnet/graphql-dotnet/issues/3812">https://github.com/graphql-dotnet/graphql-dotnet/issues/3812</a></li>
</ul>
<p>The root cause was identified as missing DI scope creation during subscription event execution.</p>
<h2 id="solution-scoped-subscription-execution-strategy" style="position:relative;"><a href="#solution-scoped-subscription-execution-strategy" aria-label="solution scoped subscription execution strategy permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Solution: Scoped Subscription Execution Strategy</h2>
<p>GraphQL.NET provides a scoped execution strategy specifically for subscriptions.</p>
<h3 id="configuration" style="position:relative;"><a href="#configuration" aria-label="configuration permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<p>Register the scoped execution strategy during GraphQL setup:</p>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp">services
    <span class="token punctuation">.</span><span class="token function">AddGraphQL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AddScopedSubscriptionExecutionStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="what-this-does" style="position:relative;"><a href="#what-this-does" aria-label="what this does permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What This Does</h3>
<ul>
<li>
<p>Creates a new DI scope for each subscription event</p>
</li>
<li>
<p>Ensures <code class="language-text">context.RequestServices</code> is valid during resolver execution</p>
</li>
<li>
<p>Enables safe resolution of scoped services</p>
</li>
<li>
<p>Aligns subscription behavior with queries and mutations</p>
</li>
</ul>
<h3 id="subscription-resolver" style="position:relative;"><a href="#subscription-resolver" aria-label="subscription resolver permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscription Resolver</h3>
<div class="gatsby-highlight" data-language="csharp"><pre class="language-csharp"><code class="language-csharp"><span class="token generic-method"><span class="token function">Field</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StringGraphType<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>
    <span class="token string">"onDataUpdated"</span><span class="token punctuation">,</span>
    <span class="token named-parameter punctuation">resolve</span><span class="token punctuation">:</span> context <span class="token operator">=></span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> service <span class="token operator">=</span> context<span class="token punctuation">.</span>RequestServices<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetRequiredService</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IMyService<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> service<span class="token punctuation">.</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="behavior-comparison" style="position:relative;"><a href="#behavior-comparison" aria-label="behavior comparison permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Behavior Comparison</h3>
<table>
<thead>
<tr>
<th>Execution Strategy</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Default strategy</td>
<td> Scoped services may fail</td>
</tr>
<tr>
<td>Scoped strategy</td>
<td> Scoped services resolve correctly</td>
</tr>
</tbody>
</table>
<h2 id="when-to-use-scoped-subscription-execution" style="position:relative;"><a href="#when-to-use-scoped-subscription-execution" aria-label="when to use scoped subscription execution permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When to Use Scoped Subscription Execution</h2>
<p>You should enable scoped subscription execution if:</p>
<ul>
<li>
<p>Your subscription resolvers use:</p>
<ul>
<li><code class="language-text">DbContext</code></li>
<li>Repository patterns</li>
<li>Any service registered as <strong>Scoped</strong></li>
</ul>
</li>
<li>
<p>You expect consistent dependency injection behavior across:</p>
<ul>
<li>Queries</li>
<li>Mutations</li>
<li>Subscriptions</li>
</ul>
</li>
</ul></article><div class="content-toolbar"><a href="https://github.com/graphql-dotnet/graphql-dotnet/edit/master/docs2/site/docs/getting-started/dependency-injection.md" rel="noopener noreferrer" target="_blank">Edit this page on GitHub</a></div></div><div class="nav"><nav><ul><li><span>Getting Started</span><nav><ul><li><a class="" href="/docs/getting-started/introduction/">Introduction</a></li><li><a class="" href="/docs/getting-started/installation/">Installation</a></li><li><a class="" href="/docs/getting-started/graphiql/">GraphiQL</a></li><li><a class="" href="/docs/getting-started/altair-graphql/">Altair GraphQL</a></li><li><a class="" href="/docs/getting-started/queries/">Queries</a></li><li><a class="" href="/docs/getting-started/schema-types/">Schema Types</a></li><li><a class="" href="/docs/getting-started/custom-scalars/">Custom Scalars</a></li><li><a class="" href="/docs/getting-started/lists-non-null/">Lists and Non-Null</a></li><li><a class="" href="/docs/getting-started/arguments/">Arguments</a></li><li><a class="" href="/docs/getting-started/aliases/">Aliases</a></li><li><a class="" href="/docs/getting-started/fragments/">Fragments</a></li><li><a class="" href="/docs/getting-started/variables/">Variables</a></li><li><a class="" href="/docs/getting-started/directives/">Directives</a></li><li><a class="" href="/docs/getting-started/mutations/">Mutations</a></li><li><a class="" href="/docs/getting-started/interfaces/">Interfaces</a></li><li><a class="" href="/docs/getting-started/unions/">Unions</a></li><li><a class="" href="/docs/getting-started/subscriptions/">Subscriptions</a></li><li><a class="" href="/docs/getting-started/transport/">Transport</a></li><li><a class="" href="/docs/getting-started/query-validation/">Query Validation</a></li><li><a class="" href="/docs/getting-started/query-organization/">Query Organization</a></li><li><a class="" href="/docs/getting-started/user-context/">User Context</a></li><li><a class="" href="/docs/getting-started/errors/">Error Handling</a></li><li><a aria-current="page" class="active" href="/docs/getting-started/dependency-injection/">Dependency Injection</a></li><li><a class="" href="/docs/getting-started/databases/">Databases</a></li><li><a class="" href="/docs/getting-started/malicious-queries/">Malicious Queries</a></li><li><a class="" href="/docs/getting-started/metadata/">Object/Field Metadata</a></li><li><a class="" href="/docs/getting-started/field-middleware/">Field Middleware</a></li><li><a class="" href="/docs/getting-started/metrics/">Metrics</a></li><li><a class="" href="/docs/getting-started/authorization/">Authorization</a></li><li><a class="" href="/docs/getting-started/relay/">Relay</a></li><li><a class="" href="/docs/getting-started/global-switches/">Global Switches</a></li></ul></nav></li><li><span>Guides</span><nav><ul><li><a class="" href="/docs/guides/serialization/">Serialization</a></li><li><a class="" href="/docs/guides/dataloader/">Dataloader</a></li><li><a class="" href="/docs/guides/complexity-analyzer/">Complexity Analyzer</a></li><li><a class="" href="/docs/guides/schema-generation/">Schema Generation</a></li><li><a class="" href="/docs/guides/known-issues/">Known Issues &amp; FAQ</a></li><li><a class="" href="/docs/guides/links/">Links</a></li><li><a class="" href="/docs/guides/document-caching/">Document Caching</a></li></ul></nav></li><li><span>Analyzers</span><nav><ul><li><a class="" href="/docs/analyzers/overview/">Overview</a></li><li><a class="" href="/docs/analyzers/gql001/">GQL001</a></li><li><a class="" href="/docs/analyzers/gql002/">GQL002</a></li><li><a class="" href="/docs/analyzers/gql003/">GQL003</a></li><li><a class="" href="/docs/analyzers/gql004/">GQL004</a></li><li><a class="" href="/docs/analyzers/gql005/">GQL005</a></li><li><a class="" href="/docs/analyzers/gql006/">GQL006</a></li><li><a class="" href="/docs/analyzers/gql007/">GQL007</a></li><li><a class="" href="/docs/analyzers/gql008/">GQL008</a></li><li><a class="" href="/docs/analyzers/gql009/">GQL009</a></li><li><a class="" href="/docs/analyzers/gql010/">GQL010</a></li><li><a class="" href="/docs/analyzers/gql011/">GQL011</a></li><li><a class="" href="/docs/analyzers/gql012/">GQL012</a></li><li><a class="" href="/docs/analyzers/gql013/">GQL013</a></li><li><a class="" href="/docs/analyzers/gql014/">GQL014</a></li><li><a class="" href="/docs/analyzers/gql015/">GQL015</a></li><li><a class="" href="/docs/analyzers/gql016/">GQL016</a></li><li><a class="" href="/docs/analyzers/gql017/">GQL017</a></li><li><a class="" href="/docs/analyzers/gql018/">GQL018</a></li><li><a class="" href="/docs/analyzers/gql019/">GQL019</a></li><li><a class="" href="/docs/analyzers/gql020/">GQL020</a></li></ul></nav></li><li><span>Migration Guides</span><nav><ul><li><a class="" href="/docs/migrations/migration8/">Migration Guide [v7 -&gt; v8]</a></li><li><a class="" href="/docs/migrations/migration7/">Migration Guide [v5 -&gt; v7]</a></li><li><a class="" href="/docs/migrations/migration5/">Migration Guide [v4 -&gt; v5]</a></li><li><a class="" href="/docs/migrations/migration4/">Migration Guide [v3 -&gt; v4]</a></li><li><a class="" href="/docs/migrations/migration3/">Migration Guide [v2 -&gt; v3]</a></li><li><a class="" href="/docs/migrations/migration2/">Migration Guide [v0.17.x -&gt; v2]</a></li><li><a class="" href="/docs/migrations/v0_11_0/">Migration Guide [v0.11.0]</a></li><li><a class="" href="/docs/migrations/v0_8_0/">Migration Guide [v0.8.0]</a></li></ul></nav></li></ul></nav></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/docs/getting-started/dependency-injection/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-d21d25920af34077797c.js\"],\"component---site-pages-landing-js\":[\"/component---site-pages-landing-js-37c578299169eb8a539f.js\"],\"component---src-components-docs-page-js\":[\"/component---src-components-docs-page-js-e3639732923322971c67.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-85ee983f7aedd5226d81.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="19418f4723c4b2a7591b";</script><script src="/webpack-runtime-a6b519b0e2448a4b4fad.js" async></script><script src="/framework-f6265dc5bf878a3c142a.js" async></script><script src="/app-d21d25920af34077797c.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>